<!doctype html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>巢湖人的比鸡</title>
    <link href="css/normalize.css" rel="stylesheet" type="text/css"/>
    <link href="css/default.css" rel="stylesheet" type="text/css">
    <link href="css/person.css?1" rel="stylesheet" type="text/css">
    <link href="css/sandao.css?1" rel="stylesheet" type="text/css">
    <link href="css/gameover.css" rel="stylesheet" type="text/css">
    <link href="css/ready.css" rel="stylesheet" type="text/css">
    <link href="css/cards.css?11" rel="stylesheet" type="text/css">
    <link href="css/example.css" rel="stylesheet">
</head>
<body>

<p class="ready ready-pos-0">
    准备
</p>
<p class="ready ready-pos-1">
    准备
</p>
<p class="ready ready-pos-2">
    准备
</p>
<p class="ready ready-pos-3">
    准备
</p>
<p class="ready ready-pos-4">
    准备
</p>

<div class="card submitted-three-pokers-0-0-0 submit-cards cards-0">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-0-0-1 submit-cards cards-0">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-0-0-2 submit-cards cards-0">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-0-1-0 submit-cards cards-0">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-0-1-1 submit-cards cards-0">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-0-1-2 submit-cards cards-0">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-0-2-0 submit-cards cards-0">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-0-2-1 submit-cards cards-0">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-0-2-2 submit-cards cards-0">
    <div class="face face-background"></div>
</div>

<div class="card submitted-three-pokers-1-0-0 submit-cards cards-1">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-1-0-1 submit-cards cards-1">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-1-0-2 submit-cards cards-1">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-1-1-0 submit-cards cards-1">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-1-1-1 submit-cards cards-1">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-1-1-2 submit-cards cards-1">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-1-2-0 submit-cards cards-1">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-1-2-1 submit-cards cards-1">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-1-2-2 submit-cards cards-1">
    <div class="face face-background"></div>
</div>

<div class="card submitted-three-pokers-2-0-0 submit-cards cards-2">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-2-0-1 submit-cards cards-2">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-2-0-2 submit-cards cards-2">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-2-1-0 submit-cards cards-2">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-2-1-1 submit-cards cards-2">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-2-1-2 submit-cards cards-2">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-2-2-0 submit-cards cards-2">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-2-2-1 submit-cards cards-2">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-2-2-2 submit-cards cards-2">
    <div class="face face-background"></div>
</div>

<div class="card submitted-three-pokers-3-0-0 submit-cards cards-3">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-3-0-1 submit-cards cards-3">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-3-0-2 submit-cards cards-3">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-3-1-0 submit-cards cards-3">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-3-1-1 submit-cards cards-3">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-3-1-2 submit-cards cards-3">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-3-2-0 submit-cards cards-3">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-3-2-1 submit-cards cards-3">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-3-2-2 submit-cards cards-3">
    <div class="face face-background"></div>
</div>

<div class="card submitted-three-pokers-4-0-0 submit-cards cards-4">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-4-0-1 submit-cards cards-4">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-4-0-2 submit-cards cards-4">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-4-1-0 submit-cards cards-4">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-4-1-1 submit-cards cards-4">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-4-1-2 submit-cards cards-4">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-4-2-0 submit-cards cards-4">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-4-2-1 submit-cards cards-4">
    <div class="face face-background"></div>
</div>
<div class="card submitted-three-pokers-4-2-2 submit-cards cards-4">
    <div class="face face-background"></div>
</div>

<div id="room_id" style="position:absolute;left:0;top:0;color:white"></div>
<div id="numth" style="position:absolute;left:0;top:15px;color:white"></div>

<article class="zzsc-container">
    <div id="container"></div>
    <!--    <div id="topbar"></div>-->
</article>
<div class="sandao" id="loadingWrapper">

    <div class="toudao">
        <div class="tou_h">
            <div class="tou_hp"><p>头</p></div>
        </div>
        <div class="tou_content">
            <div class="tou_contentp" id="tou_id"></div>
        </div>
    </div>
    <div class="zhongdao">
        <div class="zhong_h">
            <div class="zhong_hp"><p>中</p></div>
        </div>
        <div class="zhong_content">
            <div class="zhong_contentp" id="zhong_id"></div>
        </div>
    </div>
    <div class="weidao">
        <div class="wei_h">
            <div class="wei_hp"><p>尾</p></div>
        </div>
        <div class="wei_content">
            <div class="wei_contentp" id="wei_id"></div>
        </div>
    </div>

    <p class="pity giveup">
        弃牌
    </p>

    <p class="pity submit">
        提交
    </p>

    <div id='messages' style="display:none">
    </div>

</div>

<div class="sandao" id="gameover">

    <p class="pity prepare">
        准备新的一局
    </p>
    <p class="pity over">
        结束
    </p>
</div>

<!--<button id="CREATED">CREATED</button>-->
<!--<button id="STARTING">STARTING</button>-->
<!--<button id="SUBMITTING">SUBMITTING</button>-->
<!--<button id="SUBMITTED">SUBMITTED</button>-->
<!--<button id="SETTLEMENT">SETTLEMENT</button>-->

<!--script src="dist/deck.js"></script-->
<!--<script src="js/example.js"></script>-->

</body>
</html>

<script src="js/jquery.min.js"></script>
<script src="js/deck.js"></script>

<script type="text/javascript">
    var easing = Deck.easing
    var prefix = Deck.prefix
</script>
<script src="js/bijiDeck.js?1"></script>
<!--script src="js/test.js"></script-->


<script type="text/javascript">
    // 发牌组件
    var colors = ["<span style='pokerColor:red'>♦</span>", "♣", "<span style='pokerColor:red'>♥</span>", "♠"];
    var pokeStr = ["2", "3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K", "A"]
    var prefix = Deck.prefix
    var transform = prefix('transform')
    var transition = prefix('transition')
    var transitionDelay = prefix('transitionDelay')
    var translate = Deck.translate

    var roomInfo = {
        numOfPlayers: 2,
        numOfRounds: 16,
        rounds: 1,
        allPlayers: [
            {
                userId: 1,
                nickName: "a1",
            },
            {
                userId: 2,
                nickName: "a1",
            }
        ],
        mainUser: {
            userId: 1,
            nickName: "a1",
        },
        thisUserId: 1,
        roomId: 6,
        status: "STARTED",
        pointsMap: {
            1: 1,
            2: 1,
        },
        ruleConfig: {
            xiPaiPointMap: {
                QUAN_HEI: 10
            },
            surrenderNum: 1,
            comparePoints: [
                10,
                20,
                30,
                40
            ],
            surrenderPoints: [
                40
            ],
            xiPaiAddition: false,
        },
        playingRoundInfo: {
            roundId: 1,
            roomId: 6,
            startTime: "2024-01-13 20:36:33",
            pokers: [],
            initPokers9: {
                "1": [
                    18, 12, 5, 32, 48, 33, 26, 42, 50
                ],
                "2": [
                    45, 46, 24, 37, 27, 25, 35, 21, 34
                ]
            },
            userPlayMap: {
                "1": true,
                "2": true
            },
            pokers9: {
                "1": [[1,2,3],[5,6,7],[9,10,11]],
                "2": [[13,14,15],[17,18,19],[21,22,23]]
            },
            surrenders: [],
            userXipaiMap: {
                "1": ["SAN_GE_TOU"],
            },
            userPointInfoMap: {
                "1": [1,2,3,4],
                "2": [1,2,3,4],
            },
            userRountPointMap: {
                "1": 1,
                "2": 2,
            },
            status: "STARTING",
            endTime: null
        },
    }

    deck = bijiDeck(roomInfo.allPlayers.length, document.body, false);
    deck.mount(document.getElementById('container'))

    var selfSubmitInfo = {
        isPokerOver: false, // 扑克牌是不是已经翻过来了，是否正在配牌中
        pokers: [[],[],[]]   // 配牌组合
    }

    var showSettlementInfo = {
        isSettlementShow: false, // 扑克牌是不是已经翻过来了，是否正在配牌中
    }
    roomInfoClock = setInterval(init, 3000);

    init()
    function init(){
        resp = ajaxGet("/roomInfo")
        if (resp && resp.data) {
            roomInfo = resp.data
            let tUserId = roomInfo.thisUserId
            for (let i=0;i<roomInfo.allPlayers.length;i++) {
                if (roomInfo.allPlayers[0].userId !== tUserId) {
                    let p = roomInfo.allPlayers.shift()
                    roomInfo.allPlayers.push(p)
                }else {
                    break
                }
            }
            doView()
        }
    }

    /**
     * 页面渲染
     */
    function doView() {
        if (roomInfo.thisUserId === roomInfo.mainUser.userId) {
            $(".over").show()
        }
        // 等待所有玩家进入
        deck.setPeopleDetails(roomInfo.allPlayers)
        deck.setAllLeft(roomInfo.pointsMap)
        $("#room_id").html("房间号:" + roomInfo.roomId + "; 房间密码:" + roomInfo.roomPassport)
        $("#numth").html("第" + (roomInfo.rounds + 1) + "局")
        if (roomInfo.status === 'CREATED') {
            removeSubmit()
            for (var i=0;i<roomInfo.allPlayers.length;i++) {
                showReady(roomInfo.allPlayers[i].userId)
            }
        } else if (roomInfo.status === 'STARTED') {
            removePrepare()
            // 开始一回合后，以roundInfo为准
            let playingRoundInfo = roomInfo.playingRoundInfo

            // 等待所有人点准备
            if (playingRoundInfo.status === "STARTING") {
                // 重制提交信息
                resetPokerSubmitInfo()
                // 结算动画展示
                resetShowSettlementInfo()
                let selfReady = false;
                for (let uidStr of Object.keys(playingRoundInfo.userPlayMap)) {
                    let userId = parseInt(uidStr)
                    showReady(userId)
                    if (userId === roomInfo.thisUserId) {
                        selfReady = true
                    }
                }
                if (selfReady) {
                    $("#gameover").hide()
                }else {
                    $("#gameover").show()
                }
            }

            // 等待所有人提交
            if (playingRoundInfo.status === "SUBMITTING" ) {
                let selfSubmit = false
                let userIds = []
                for (let userIdStr of Object.keys(playingRoundInfo.pokers9)) {
                    let userId = parseInt(userIdStr)
                    userIds.push(userId)
                    if (userId === roomInfo.thisUserId) {
                        selfSubmit = true
                    }
                }
                deck.bijiSubmit(getSubmittedPeopleIndex(userIds));
                if (!selfSubmit) {
                    if (!selfSubmitInfo.isPokerOver) {
                        // 不在配牌中，展示发牌动画，并设置 selfSubmitInfo.isSelfConfig = true
                        dealCards();
                        deck.shuffle();
                        selfSubmitInfo.isPokerOver = true
                    }
                }
            }

            // 结算/结束了
            if (playingRoundInfo.status === "SETTLEMENT" || playingRoundInfo.status === "END") {
                // 展示settlement动画
                if (!showSettlementInfo.isSettlementShow) {
                    removeSubmit();
                    showSettlement();
                    showSettlementInfo.isSettlementShow = true
                }
            }
        }
    }


    function showSettlement(){
        removeSubmit();

        var str = '<table id="bifen-table">';
        str = str + '<tr><th>玩家</th><th>牌型</th><th colspan="3">比分</th><th>喜牌</th><th>小计</th><th>总计</th></tr>';
        let playingRoundInfo = roomInfo.playingRoundInfo
        let i = 0
        for(let userId of Object.keys(playingRoundInfo.userPlayMap)){

            let surrender = playingRoundInfo.surrenders.indexOf(parseInt(userId)) > -1
            let pokers9 = playingRoundInfo.pokers9[userId] // [[1,2,3],[4,5,6],[7,8,9]]
            var pointInfo = playingRoundInfo.userPointInfoMap[userId] // [1,2,3,4]
            var userXipaiDesc = playingRoundInfo.userXipaiMap[userId]?playingRoundInfo.userXipaiMap[userId]:[] // ["三个头“]
            var userPoint = playingRoundInfo.userRountPointMap[userId] // 本round分数
            var roomPoint = roomInfo.pointsMap[userId]; // 总分
            str += '<tr>';
            // 用户
            str += '<td>' + userId + (surrender?'（弃牌）':'') +'</td>';

            // 牌型
            str += '<td>';
            if(surrender){
                str += '弃牌';
            }else{
                for(var j=0;j<3;j++){
                    for(var k=0;k<3;k++)
                        str += pokerViewStr(pokers9[j][k]) + (k!==2?',':'');
                    str += ';'
                }
            }
            str += '</td>';

            // 比分
            for(var j=0;j<3;j++){
                str += '<td>' + pointInfo[j] + '</td>';
            }
            // 喜牌
            str += '<td>' + pointInfo[3] + '(' + userXipaiDesc.join(',') + ')</td>';
            // 小记
            str += '<td>' + userPoint + '</td>';
            // 总计
            str += '<td>' + roomPoint + '</td>';

            str += '</tr>';
        }
        str += '</table>';
        // 将这个表格输出出去

        // 计算比分展示顺序
        var biFenViewSort = getSortBifenDetail();

        for(let ii=0; ii<biFenViewSort.length; ii++){
            var tpokers = biFenViewSort[ii].tpokers;
            var this_person_id = biFenViewSort[ii].person_id;
            var point = biFenViewSort[ii].point;
            var this_person_detail = witchDeckPersonDetail(this_person_id);
            sortViewOrderTpukes(ii, roomInfo.allPlayers.length, this_person_detail, tpokers, point)
        }
        setTimeout(function(){
            $("#gameover").show();
            for(var st=0;st<roomInfo.allPlayers.length;st++){
                deck.setTotalLeft(roomInfo.allPlayers[st].userId, roomInfo.pointsMap[roomInfo.allPlayers[st].userId]);
            }
        },1500+500*biFenViewSort.length);
        $("#gameover").append($(str));
        return;
    }


    function removeSubmit(){
        for(var i=0;i<5;i++)
            $(".cards-"+i).hide(500);
    }

    function resetPokerSubmitInfo() {
        selfSubmitInfo = {
            isPokerOver: false,
            pokers: [[],[],[]]
        }
    }
    function resetShowSettlementInfo() {
        showSettlementInfo.isSettlementShow = false
    }


    // 返回已经准备好的人在桌子上的顺序
    function getSubmittedPeopleIndex(userIds) {
        var A = [];
        for (var i = 0; i < userIds.length; i++) {
            A.push(witchDeckPersonDetail(userIds[i]).index);
        }
        return A;
    }

    function showReady(userId) {
        var this_person_detail = witchDeckPersonDetail(userId);
        $(".ready-pos-" + this_person_detail.index).show();
    }
    function witchDeckPersonDetail(person_id) {
        for (var i = 0; i < deck.people_detail.length; i++) {
            if (deck.people_detail[i].person_id === person_id) {
                return deck.people_detail[i];
            }
        }
    }

    /**
     * 发牌
     */
    function dealCards(){
        removePrepare();
        for(let userId of Object.keys(roomInfo.playingRoundInfo.initPokers9)){
            if(roomInfo.thisUserId === parseInt(userId) && ($("#loadingWrapper").css("display") == "" || $("#loadingWrapper").css("display") == "none")){
                var B = [];
                for(var b=0;b<roomInfo.playingRoundInfo.initPokers9[userId].length;b++){
                    B.push(btof(roomInfo.playingRoundInfo.initPokers9[userId][b]));
                }
                deck.bijiPoker();
                deck.bijiPokerOver(B);
                break;
            }
        }
    }

    function pokerViewStr(i) {
        p = (i - i%4)/4
        c = i%4
        return pokeStr[p] + colors[c]
    }


    // 获得显示比分顺序的数组
    function getSortBifenDetail(){
        let playingRound = roomInfo.playingRoundInfo
        let poker9Map = playingRound.pokers9
        let userPointInfoMap = playingRound.userPointInfoMap
        var A = [];
        for(var i=0; i<3 ;i++){
            var userPoker3List = []
            for (let userId of Object.keys(poker9Map)) {
                poker9 = poker9Map[userId]
                userPoker3List.push(
                    {
                        userId: parseInt(userId),
                        poker3: poker9[i],
                        point: userPointInfoMap[userId][i],
                    }
                )
            }
            userPoker3List.sort(function(a,b){return a.point-b.point});
            for(var j=0;j<userPoker3List.length;j++){
                A.push(
                    {
                        tpokers: userPoker3List[j].poker3,
                        point: userPoker3List[j].point,
                        person_id: userPoker3List[j].userId,
                    }
                );
            }
        }
        return A;
    }

    // 设置结算展示
    function sortViewOrderTpukes(i,people_num,this_person_detail,tpokers,point){
        setTimeout(function(){
            i = i-i%people_num;
            for(let m=0;m<3;m++){
                $cardi = myCard(btof(tpokers[m]),90);
                $cardi.addClass('three-pokers');
                $cardi.addClass('three-pokers-'+this_person_detail.index+'-'+i/people_num+'-'+m);
                $('body').append($cardi);
            }
            var $pointi = $('<div class="point-'+this_person_detail.index+'-'+i/people_num+'"></div>');
            $pointi.html(point>0?('+'+point):point);
            $pointi.addClass("point");
            $('body').append($pointi);
        },500+500*i);
    }

    function btof(id){
        var color = (id)%4;
        var index = (id-color)/4;
        if(index == 12){
            index = 0;
        }else{
            index = index + 1;
        }
        return (3-color)*13 + index;
    }

    function ftob(id){
        var index = id%13;
        var color = (id - index)/13;

        if(index == 0){
            index = 12;
        }else{
            index = index - 1;
        }
        return index*4 + (3-color);
    }

    // front card id
    function myCard(id,heightSize){
        var index = id%13;
        var color = (id-index)/13;
        index = index + 1;
        var indexStr = index === 1 ? 'A' : index === 11 ? 'J' : index === 12 ? 'Q' : index === 13 ? 'K' : index;
        var colorStr = color === 0 ? 'spades' : color === 1 ? 'hearts' : color === 2 ? 'clubs' : color === 3 ? 'diamonds' : 'joker';

        if(!heightSize){
            var str = '<div class="card '+colorStr+' '+colorStr+''+index+'" style="transition: all 0.01s cubic-bezier(0.215, 0.61, 0.355, 1) 0s;"><div class="topleft">'+indexStr+'</div><div class="bottomright">'+indexStr+'</div><div class="face"></div></div>'
            return $(str);
        }
        if(heightSize > 70){
            var str = '<div class="card '+colorStr+' '+colorStr+''+index+'" style="width:'+(heightSize*0.7)+'px;height:'+heightSize+'px;transition: all 0.01s cubic-bezier(0.215, 0.61, 0.355, 1) 0s;"><div class="topleft">'+indexStr+'</div><div class="bottomright">'+indexStr+'</div><div class="face"></div></div>'
            return $(str);
        }else if(heightSize < 70){
            var str = '<div class="card '+colorStr+' '+colorStr+''+index+'" style="width:'+(heightSize*0.7)+'px;height:'+heightSize+'px;transition: all 0.01s cubic-bezier(0.215, 0.61, 0.355, 1) 0s;"><div class="topleft no-top">'+indexStr+'</div><div class="bottomright no-bottom">'+indexStr+'</div><div class="face"></div></div>'
            return $(str);
        }
    }
    function removePrepare(){
        $(".ready").hide();
    }

    // 一提交的隐藏掉
    function submittedView(){
        $('.sandao .card,.sandao .deck').remove();
        deck.first = [];
        deck.second = [];
        deck.third = [];
        $('#loadingWrapper').hide();
        deck.my_cards = [];
    }

    // 使用可变宽度框架
    function changeCardCss($card){
        $card.style.width = "42px";
        $card.style.height = "60px";
        $card.style.transform = '';
        $card.style.left = 'unset';
        $card.style.top = 'unset';
        $card.style.marginLeft = '4px';
        $card.style.marginRight = '4px';
        $card.style.display = 'block';
        $card.style.zIndex = '0';
        $card.style.position = 'relative';
        $card.style.float = 'left';
    }

    function ajaxGet(url){
        var data;
        $.ajax({
            url : url,
            type : "get",
            crossDomain:false,
            async:false,
            contentType: "application/json; charset=utf-8",
            success : function(resp){
                if (resp.isError) {
                    alert(resp.errMsg)
                    if (resp.errCode == 1001) {
                        // 跳转登陆页
                        window.location.href = '/login.html';
                    }
                    if (resp.errCode == 1002) {
                        // 跳转登陆页
                        window.location.href = '/hall.html';
                    }
                    if (resp.errCode == 2001) {
                        // 参数错误
                    }
                }
                data = resp
            },
            error:function (XMLHttpRequest, textStatus, errorThrown) {
                console.log(XMLHttpRequest.status);
                console.log(XMLHttpRequest.readyState);
                console.log(textStatus);
            }
        });
        return data;
    }
    function ajaxPost(url, requestBody){
        var data;
        $.ajax({
            url: url,
            type: "post",
            crossDomain: false,
            async: false,
            data: requestBody,
            contentType: "application/json; charset=utf-8",
            success : function(resp){
                if (resp.isError) {
                    alert(resp.errMsg)
                    if (resp.errCode == 1001) {
                        // 跳转登陆页
                        window.location.href = '/login.html';
                    }
                    if (resp.errCode == 1002) {
                        // 跳转登陆页
                        window.location.href = '/hall.html';
                    }
                    if (resp.errCode == 2001) {
                        // 参数错误
                    }
                }
                data = resp
            },
            error:function (XMLHttpRequest, textStatus, errorThrown) {
                console.log(XMLHttpRequest.status);
                console.log(XMLHttpRequest.readyState);
                console.log(textStatus);
            }
        });
        return data;
    }

    //
    // $("#CREATED").click(function(){
    //     roomInfo.status = "CREATED"
    //     doView()
    // })
    // $("#STARTING").click(function(){
    //     roomInfo.status = "STARTED"
    //     roomInfo.playingRoundInfo.status = "STARTING"
    //     doView()
    // })
    //
    // $("#SUBMITTING").click(function(){
    //     roomInfo.status = "STARTED"
    //     roomInfo.playingRoundInfo.status = "SUBMITTING"
    //     delete roomInfo.playingRoundInfo.pokers9[roomInfo.thisUserId + ""]
    //     doView()
    // })
    // $("#SUBMITTED").click(function(){
    //     roomInfo.status = "STARTED"
    //     roomInfo.playingRoundInfo.status = "SUBMITTING"
    //     roomInfo.playingRoundInfo.pokers9[roomInfo.thisUserId + ""] = [[1,2,3],[5,6,7],[9,10,11]],
    //     doView()
    // })
    // $("#SETTLEMENT").click(function(){
    //     roomInfo.status = "STARTED"
    //     roomInfo.playingRoundInfo.status = "SETTLEMENT"
    //     roomInfo.pointsMap["1"] = 1000
    //     doView()
    // })



    $(".toudao").click(function(){
        if(deck.first.length === 0){
            var A = [];
            for(var i=0;i<deck.my_cards.length;i++){
                if(deck.my_cards[i].chosen){
                    A.push(deck.my_cards[i].i);
                }
            }
            if(A.length == 3){

                for(var i=0;i<deck.my_cards.length;i++){

                    if(deck.my_cards[i].i == A[0] || deck.my_cards[i].i == A[1] || deck.my_cards[i].i == A[2]){
                        deck.my_cards[i].$el.style.display = "none";
                        deck.my_cards[i].chosen = false;
                        deck.my_cards[i].$el.style.top = parseInt(deck.my_cards[i].$el.style.top.substring(0,deck.my_cards[i].$el.style.top.length-2)) + 10 + 'px';
                    }

                }

                deck.first = A;
                for(var i=0;i<3;i++){
                    var card = Deck.Card(A[i],true);
                    changeCardCss(card.$el);
                    var tou_content = document.getElementById("tou_id");
                    tou_content.appendChild(card.$el);
                    $('.toudao .topleft').css("top","0");
                    $('.toudao .bottomright').css("bottom","0");
                }
            }
        }else{
            for(var i=0;i<deck.my_cards.length;i++){
                if(deck.my_cards[i].i == deck.first[0] || deck.my_cards[i].i == deck.first[1] || deck.my_cards[i].i == deck.first[2]){
                    deck.my_cards[i].$el.style.display = "block";
                }
            }

            $(".toudao .card").remove();

            deck.first = [];
        }
    })

    $(".zhongdao").click(function(){
        if(deck.second.length === 0){
            var A = [];
            for(var i=0;i<deck.my_cards.length;i++){
                if(deck.my_cards[i].chosen){
                    A.push(deck.my_cards[i].i);
                }
            }
            if(A.length == 3){

                for(var i=0;i<deck.my_cards.length;i++){

                    if(deck.my_cards[i].i == A[0] || deck.my_cards[i].i == A[1] || deck.my_cards[i].i == A[2]){
                        deck.my_cards[i].$el.style.display = "none";
                        deck.my_cards[i].chosen = false;
                        deck.my_cards[i].$el.style.top = parseInt(deck.my_cards[i].$el.style.top.substring(0,deck.my_cards[i].$el.style.top.length-2)) + 10 + 'px';
                    }

                }

                deck.second = A;
                for(var i=0;i<3;i++){
                    var card = Deck.Card(A[i],true);
                    changeCardCss(card.$el);
                    var tou_content = document.getElementById("zhong_id");
                    tou_content.appendChild(card.$el);

                    $('.zhongdao .topleft').css("top","0");
                    $('.zhongdao .bottomright').css("bottom","0");
                }
            }
        }else{
            for(var i=0;i<deck.my_cards.length;i++){
                if(deck.my_cards[i].i == deck.second[0] || deck.my_cards[i].i == deck.second[1] || deck.my_cards[i].i == deck.second[2]){
                    deck.my_cards[i].$el.style.display = "block";
                }
            }

            $(".zhongdao .card").remove();

            deck.second = [];
        }
    })

    $(".weidao").click(function(){
        if(deck.third.length === 0){
            var A = [];
            for(var i=0;i<deck.my_cards.length;i++){
                if(deck.my_cards[i].chosen){
                    A.push(deck.my_cards[i].i);
                }
            }
            if(A.length == 3){

                for(var i=0;i<deck.my_cards.length;i++){

                    if(deck.my_cards[i].i == A[0] || deck.my_cards[i].i == A[1] || deck.my_cards[i].i == A[2]){
                        deck.my_cards[i].$el.style.display = "none";
                        deck.my_cards[i].chosen = false;
                        deck.my_cards[i].$el.style.top = parseInt(deck.my_cards[i].$el.style.top.substring(0,deck.my_cards[i].$el.style.top.length-2)) + 10 + 'px';
                    }

                }

                deck.third = A;
                for(var i=0;i<3;i++){
                    var card = Deck.Card(A[i],true);
                    changeCardCss(card.$el);
                    var tou_content = document.getElementById("wei_id");
                    tou_content.appendChild(card.$el);
                    $('.weidao .topleft').css("top","0");
                    $('.weidao .bottomright').css("bottom","0");
                }
            }
        }else{
            for(var i=0;i<deck.my_cards.length;i++){
                if(deck.my_cards[i].i == deck.third[0] || deck.my_cards[i].i == deck.third[1] || deck.my_cards[i].i == deck.third[2]){
                    deck.my_cards[i].$el.style.display = "block";
                }
            }

            $(".weidao .card").remove();

            deck.third = [];
        }
    })

    $(".submit").click(function(){
        var arr = [];
        removePrepare();
        if(deck.first.length != 3 || deck.second.length != 3 || deck.third.length != 3){
            return;
        }
        for(var i=0;i<3;i++) {
            arr.push(ftob(deck.first[i]));
        }
        for(var i=0;i<3;i++) {
            arr.push(ftob(deck.second[i]));
        }
        for(var i=0;i<3;i++) {
            arr.push(ftob(deck.third[i]));
        }

        console.log(arr)

        let submitInfo = {
            surrender: false,
            pokerIds: arr
        }
        let requestBody = JSON.stringify(submitInfo)
        let resp = ajaxPost("/submit", requestBody);
        // 隐藏
        if (!resp.isError) {
            submittedView();
        }
        // 隐藏
        submittedView();
    })

    $(".giveup").click(function(){
        if(confirm("牌还不错哎，你在看看？确定就真的投降了哎！！！")){
            let submitInfo = {
                surrender: true
            }
            let requestBody = JSON.stringify(submitInfo)
            let resp = ajaxPost("/submit", requestBody);
            // 隐藏
            if (!resp.isError) {
                submittedView();
            }
        }
    })

    $(".prepare").click(function(){
        let resp = ajaxGet("/ready");
        if(!resp.isError){
            removePrepare();
            $('body .point, body .three-pokers').remove();
            $("#gameover").hide();
            $("#gameover table").remove();
        }
    })

    $(".over").click(function(){
        let resp = ajaxGet("/endRoom")
        if(!resp.isError){
            removePrepare();
            $('body .point, body .three-pokers').remove();
            $("#gameover").hide();
            $("#gameover table").remove();
            setTimeout(function () {
                window.location.href = '/hall.html';
            }, 2000)
        }
    })

</script>